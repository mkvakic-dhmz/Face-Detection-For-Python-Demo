Bootstrap: docker
From: python:3.10-slim-bookworm

%files
    requirements.txt /opt/dwd/requirements.txt
    face.py /opt/dwd/face.py

%post
    # Install base packages
    export DEBIAN_FRONTEND=noninteractive && \
    apt-get update && apt-get install -y \
        git \
        && rm -rf /var/lib/apt/lists/*
    
    # Set up virtual environment & install dependencies
    python3 -m venv /opt/dwd/venv && \
        . /opt/dwd/venv/bin/activate && \
        pip install -r /opt/dwd/requirements.txt && \
        pip cache purge

    # Change face.py's permissions
    chmod 755 /opt/dwd/face.py

%environment
    . /opt/dwd/venv/bin/activate

%runscript
    exec /opt/dwd/face.py "$@"
